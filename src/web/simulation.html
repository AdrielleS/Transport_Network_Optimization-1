<!DOCTYPE html>
<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    function initMap() {
        var service = new google.maps.DirectionsService;
        var map = new google.maps.Map(document.getElementById('map'));

        // list of points
        var stations = [
{lat: -23.756720539855742, lng: -46.605552988710514, name: '424029'},
{lat: -23.755038383949234, lng: -46.60476659421608, name: '434025'},
{lat: -23.753210736347008, lng: -46.603407252991616, name: '431032'},
{lat: -23.751061576588985, lng: -46.59959999656993, name: '432031'},
{lat: -23.750461275658115, lng: -46.59808144814363, name: '422038'},
{lat: -23.747614914179405, lng: -46.597220790415285, name: '424030'},
{lat: -23.746660698617394, lng: -46.597622921592354, name: '425038'},
{lat: -23.743439286805284, lng: -46.598941087019604, name: '434026'},
{lat: -23.741794070505243, lng: -46.600244387976055, name: '428028'},
{lat: -23.74035803034564, lng: -46.59836346686237, name: '429037'},
{lat: -23.739645393994195, lng: -46.59650319668104, name: '426033'},
{lat: -23.73935098831965, lng: -46.59343612777153, name: '431033'},
{lat: -23.7378168508699, lng: -46.591208959794834, name: '432032'},
{lat: -23.736460291169763, lng: -46.59064883550037, name: '435032'},
{lat: -23.735675574726088, lng: -46.58744083631835, name: '424031'},
{lat: -23.734975872586574, lng: -46.58493963114524, name: '425039'},
{lat: -23.73543905953678, lng: -46.58325931666062, name: '427037'},
{lat: -23.7356664561805, lng: -46.58037785427469, name: '434027'},
{lat: -23.73409038526593, lng: -46.57926791361143, name: '426034'},
{lat: -23.731579513328388, lng: -46.5784680596692, name: '421037'},
{lat: -23.729660674577932, lng: -46.577933049252735, name: '429038'},
{lat: -23.728252322765595, lng: -46.57690634655621, name: '424015'},
{lat: -23.725536883594316, lng: -46.57446542866766, name: '421038'},
{lat: -23.723835289487212, lng: -46.57520733361338, name: '422039'},
{lat: -23.72383882418197, lng: -46.579521440873584, name: '424032'},
{lat: -23.721923318229425, lng: -46.58055167591755, name: '425040'},
{lat: -23.71894361462406, lng: -46.58227762931872, name: '434028'},
{lat: -23.717538191306186, lng: -46.58355467640381, name: '428029'},
{lat: -23.715711535319784, lng: -46.585261216068304, name: '429039'},
{lat: -23.713940048626622, lng: -46.58658819408437, name: '426035'},
{lat: -23.711710292598504, lng: -46.58751337626241, name: '469003'},
{lat: -23.710061, lng: -46.588239, name: '432003'},
{lat: -23.707050470397828, lng: -46.588579111854976, name: '423003'},
{lat: -23.705558331846092, lng: -46.588494024177024, name: '430035'},
{lat: -23.70149842832478, lng: -46.587707717953535, name: '427004'},
{lat: -23.700406915646425, lng: -46.5873749554384, name: '472002'},
{lat: -23.698078789531632, lng: -46.58595529710997, name: '432039'},
{lat: -23.695585726616883, lng: -46.58467917915707, name: '472003'},
{lat: -23.694639971732386, lng: -46.58426191828935, name: '473002'},
{lat: -23.692999164762966, lng: -46.583613589168735, name: '5693232772153344'},
{lat: -23.691714258828757, lng: -46.58221524564029, name: '158146019'},
{lat: -23.691468371635942, lng: -46.582046720592544, name: '160236002'},
{lat: -23.690149243459214, lng: -46.58174891325236, name: '425041'},
{lat: -23.686451828200493, lng: -46.583354063251434, name: '427038'},
{lat: -23.682773538815766, lng: -46.58292527145923, name: '429040'},
{lat: -23.679161898955673, lng: -46.583128744112045, name: '430036'},
{lat: -23.67667518577764, lng: -46.583156470338054, name: '431034'},
{lat: -23.67490218854324, lng: -46.58305798379141, name: '435033'},
{lat: -23.67457357718782, lng: -46.582704984437356, name: '156536002'},
{lat: -23.673725526050333, lng: -46.58160734338094, name: '6539363163308032'},
{lat: -23.669697265829328, lng: -46.579874626994, name: '434029'},
{lat: -23.66788889643966, lng: -46.57745649193765, name: '426037'},
{lat: -23.667377, lng: -46.575727, name: '421040'},
{lat: -23.663011943631354, lng: -46.57410843470361, name: '427018'},
{lat: -23.655086, lng: -46.577615, name: '421004'},
{lat: -23.65198864956633, lng: -46.579333403754916, name: '422007'},
{lat: -23.646937429098728, lng: -46.58216145456915, name: '425034'},
{lat: -23.642044773336437, lng: -46.58701506351878, name: '435002'},
{lat: -23.63875357719719, lng: -46.591331296145086, name: '423006'},
{lat: -23.63651317336133, lng: -46.594164179894946, name: '434030'},
{lat: -23.6270516372138, lng: -46.5965077171777, name: '429032'},
{lat: -23.624884159762914, lng: -46.59881596303971, name: '429041'},
{lat: -23.61997859120926, lng: -46.60132505587184, name: '421033'},
{lat: -23.617433392852398, lng: -46.601529515953935, name: '428006'},
{lat: -23.614468525398223, lng: -46.60086024754834, name: '421022'},
{lat: -23.61242461197325, lng: -46.60033854818469, name: '421034'},
{lat: -23.610008445931758, lng: -46.59973296170613, name: '435022'},
{lat: -23.605036410026194, lng: -46.599501427546116, name: '430030'},
{lat: -23.603120185337502, lng: -46.6027281456668, name: '4901873499242496'},
        ];

        var route = [
{lat: -23.736460291169763, lng: -46.59064883550037, name: '435032'},
{lat: -23.735675574726088, lng: -46.58744083631835, name: '424031'},
{lat: -23.734975872586574, lng: -46.58493963114524, name: '425039'},
{lat: -23.73543905953678, lng: -46.58325931666062, name: '427037'},
{lat: -23.7356664561805, lng: -46.58037785427469, name: '434027'},
{lat: -23.73409038526593, lng: -46.57926791361143, name: '426034'},
{lat: -23.731579513328388, lng: -46.5784680596692, name: '421037'},
{lat: -23.729660674577932, lng: -46.577933049252735, name: '429038'},
{lat: -23.728252322765595, lng: -46.57690634655621, name: '424015'},
{lat: -23.725536883594316, lng: -46.57446542866766, name: '421038'},
{lat: -23.723835289487212, lng: -46.57520733361338, name: '422039'},
{lat: -23.72383882418197, lng: -46.579521440873584, name: '424032'},
{lat: -23.721923318229425, lng: -46.58055167591755, name: '425040'},
{lat: -23.71894361462406, lng: -46.58227762931872, name: '434028'},
{lat: -23.717538191306186, lng: -46.58355467640381, name: '428029'},
{lat: -23.715711535319784, lng: -46.585261216068304, name: '429039'},
{lat: -23.713940048626622, lng: -46.58658819408437, name: '426035'},
{lat: -23.711710292598504, lng: -46.58751337626241, name: '469003'},
{lat: -23.710061, lng: -46.588239, name: '432003'},
{lat: -23.707050470397828, lng: -46.588579111854976, name: '423003'},
{lat: -23.705558331846092, lng: -46.588494024177024, name: '430035'},
{lat: -23.70149842832478, lng: -46.587707717953535, name: '427004'},
{lat: -23.700406915646425, lng: -46.5873749554384, name: '472002'},
{lat: -23.698078789531632, lng: -46.58595529710997, name: '432039'},
{lat: -23.695585726616883, lng: -46.58467917915707, name: '472003'},
{lat: -23.694639971732386, lng: -46.58426191828935, name: '473002'},
{lat: -23.692999164762966, lng: -46.583613589168735, name: '5693232772153344'},
{lat: -23.691714258828757, lng: -46.58221524564029, name: '158146019'},
{lat: -23.691468371635942, lng: -46.582046720592544, name: '160236002'},
{lat: -23.690149243459214, lng: -46.58174891325236, name: '425041'},
{lat: -23.686451828200493, lng: -46.583354063251434, name: '427038'},
{lat: -23.682773538815766, lng: -46.58292527145923, name: '429040'},
{lat: -23.679161898955673, lng: -46.583128744112045, name: '430036'},
{lat: -23.67667518577764, lng: -46.583156470338054, name: '431034'},
        ];

        // Zoom and center map automatically by stations (each station will be in visible map area)
        var lngs = stations.map(function(station) { return station.lng; });
        var lats = stations.map(function(station) { return station.lat; });
        map.fitBounds({
            west: Math.min.apply(null, lngs),
            east: Math.max.apply(null, lngs),
            north: Math.min.apply(null, lats),
            south: Math.max.apply(null, lats),
        });

        // Show stations on the map as markers
        /*
        for (var i = 0; i < stations.length; i++) {
            if (!stations[i].name)
                continue;
            new google.maps.Marker({
                position: stations[i],
                map: map,
                title: stations[i].name
            });
        }
        */

        // Divide route to several parts because max stations limit is 25 (23 waypoints + 1 origin + 1 destination)
        for (var i = 0, parts = [], max = 8 - 1; i < route.length; i = i + max)
            parts.push(route.slice(i, i + max + 1));

        // Callback function to process service results
        var service_callback = function(response, status) {
            if (status != 'OK') {
                console.log('Directions request failed due to ' + status);
                return;
            }
            var renderer = new google.maps.DirectionsRenderer;
            renderer.setMap(map);
            renderer.setOptions({ suppressMarkers: true, preserveViewport: true });
            renderer.setDirections(response);
        };

        // Send requests to service to get route (for stations count <= 25 only one request will be sent)
        for (var i = 0; i < parts.length; i++) {
            // Waypoints does not include first station (origin) and last station (destination)
            var waypoints = [];
            for (var j = 1; j < parts[i].length - 1; j++)
                waypoints.push({location: parts[i][j], stopover: true});
            // Service options
            var service_options = {
                origin: parts[i][0],
                destination: parts[i][parts[i].length - 1],
                waypoints: waypoints,
                travelMode: 'DRIVING'
            };
            // Send request
            service.route(service_options, service_callback);
        }

        new google.maps.Marker({
            position: new google.maps.LatLng(-23.735435542689128, -46.59084340917914),
            map: map,
            title: 'startOrigin',
            icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
            label: { color: '#2F00DA', fontWeight: 'bold', fontSize: '14px', text: 'Origem' }
        });
        new google.maps.Marker({
            position: new google.maps.LatLng(-23.736460291169763, -46.59064883550037),
            map: map,
            title: 'startDest',
            icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
            label: { color: '#2F00DA', fontWeight: 'bold', fontSize: '14px', text: 'Parada da origem' }
        });
        new google.maps.Marker({
            position: new google.maps.LatLng(-23.676446193081002, -46.60578808412785),
            map: map,
            title: 'endOrigin',
            icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
            label: { color: '#2F00DA', fontWeight: 'bold', fontSize: '14px', text: 'Destino' }
        });
        new google.maps.Marker({
            position: new google.maps.LatLng(-23.67667518577764, -46.583156470338054),
            map: map,
            title: 'endDest',
            icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
            label: { color: '#2F00DA', fontWeight: 'bold', fontSize: '14px', text: 'Parada do destino' }
        });

        service_options = {
            origin: '-23.735435542689128, -46.59084340917914',
            destination: '-23.736460291169763, -46.59064883550037',
            travelMode: 'WALKING'
        };
        // Send request
        service.route(service_options, service_callback);

        service_options = {
            origin: '-23.676446193081002, -46.60578808412785',
            destination: '-23.67667518577764, -46.583156470338054',
            travelMode: 'WALKING'
        };
        // Send request
        service.route(service_options, service_callback);
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4nuxucJdREFeUZ_8NtmgtX1tBf1ShurU&callback=initMap"
        async defer></script>
</body>
</html>